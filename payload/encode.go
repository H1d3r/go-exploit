// Payload related functions and actions
//
// The payload package contains a collection of universally applicable functions for payloads, sub-packages
// containing specific payloads, and any specific payloads that do not fit into the other sub package types.
package payload

import (
	b64 "encoding/base64"
	"fmt"
	"regexp"
)

func EncodeCommandBrace(cmd string) string {
	escaped := regexp.MustCompile(`([{,}])`).ReplaceAllString(cmd, `\$1`)

	return "{" + regexp.MustCompile(`\s+`).ReplaceAllString(escaped, ",") + "}"
}

func EncodeCommandIFS(cmd string) string {
	return regexp.MustCompile(`\s+`).ReplaceAllLiteralString(cmd, "${IFS}")
}

// Base64 encodes the command. Wraps it in logic to base64 decode and pipe to bash.
func EncodeEchoBase64ToBash(cmd string) string {
	cmd64 := b64.StdEncoding.EncodeToString([]byte(cmd))

	return fmt.Sprintf("echo %s|base64 -d|bash", cmd64)
}
