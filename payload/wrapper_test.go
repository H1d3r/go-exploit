package payload_test

import (
	"testing"

	"github.com/vulncheck-oss/go-exploit/payload"
)

func TestBase64EncodeForBash(t *testing.T) {
	encoded := payload.Base64EncodeForBash("whoami; id;")

	if encoded != "echo d2hvYW1pOyBpZDs=|base64 -d|bash" {
		t.Fatal(encoded)
	}

	t.Log(encoded)
}

func TestBase64EncodeForGroovyEval(t *testing.T) {
	encoded := payload.Base64EncodeForGroovyEval("def f = new File('/tmp/vvNddILf');")

	if encoded != "Eval.me(new String('ZGVmIGYgPSBuZXcgRmlsZSgnL3RtcC92dk5kZElMZicpOw=='.decodeBase64()))" {
		t.Fatal(encoded)
	}

	t.Log(encoded)
}

func TestBase64EncodeFoPHPEval(t *testing.T) {
	encoded := payload.Base64EncodeForPHPEval(`print("hi");`)

	if encoded != `<?php eval(base64_decode("cHJpbnQoImhpIik7")); ?>` {
		t.Fatal(encoded)
	}

	t.Log(encoded)
}
